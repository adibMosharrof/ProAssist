
## ðŸ“Š Example Walkthrough

### Input Data:

**Video Transcript Segments (7 segments)**:
These represent key actions extracted from the video transcript:
1. ðŸŸ¢ [94.4s-105.2s] attach interior to chassis
2. ðŸ”µ [105.2s-153.6s] attach wheel to chassis
3. ðŸ”µ [153.6s-171.7s] attach arm to turntable top
4. ðŸŸ¡ [171.7s-187.1s] attach hook to arm
5. ðŸŸ¡ [187.1s-203.7s] attach turntable top to chassis
6. âšª [203.7s-213.1s] attach cabin to interior
7. ðŸŸ£ [213.1s-232.0s] demonstrate functionality

**Procedure Steps (6 steps)**:
These are the predefined procedural steps for completing the task:
1. ðŸŸ¢ Assemble the chassis by attaching and screwing the chassis parts together.
2. ðŸ”µ Attach wheels to the chassis.
3. ðŸŸ¡ Assemble the arm and attach it to the chassis.
4. âšª Attach the body to the chassis.
5. ðŸŸ£ Add the cabin window to the chassis.
6. ðŸ”´ Finalize the assembly and demonstrate the toy's functionality.


We want to match the procedure steps to the video transcript segments.

The LLM will receive **only the text** of both the procedure steps and the video transcript segments. It will not have access to the video itself, only the text descriptions of what happened in the video.

### Mapping Definition:

The mapping output should be a dictionary where:
- **Key**: Procedure step ID (as a string)
- **Value**: List of video segment IDs (as strings) that correspond to this procedure step

This mapping indicates which video segments are evidence of performing each procedure step. One procedure step may span multiple video segments. **Each video segment maps to exactly one procedure step** - each segment can only belong to one procedure step, and there should be no unmapped segments.

### Temporal Order Requirements:

The mapping must maintain **temporal coherence**:
- Video segments assigned to the same procedure step should be **consecutive or temporally close** (they occur around the same time in the video)
- Procedure steps should be assigned to segments in **chronological order** - a procedure step cannot be assigned to segments that occur before segments of an earlier procedure step
- If a procedure step occurs in multiple disjoint time periods in the video, each period should be treated as a separate mapping entry or the step should be split accordingly
- All mapped segments must respect the temporal ordering of the video (segment 1 occurs before segment 2, etc.)

### LLM Input:

The LLM receives **only text descriptions** - no video, no images, no additional context. The actual input data consists of:
1. The list of procedure steps (text descriptions)
2. The list of video transcript segments (text descriptions with timestamps)

The matching requirements and temporal constraints are provided as **guidelines in the prompt** (not as separate input data) to help the LLM understand how to format its output and what rules to follow.

The LLM must infer the best matching based purely on semantic similarity and logical procedural flow.

### LLM Prompt:

```text
You are a helpful assistant that matches procedure steps to video transcript segments.

For each procedure step, identify which video transcript segments represent the execution of that step. Multiple segments may map to a single step if they are consecutive actions that together accomplish that step.

IMPORTANT REQUIREMENTS:
- Both procedure steps and video segments are listed in temporal order (step 1 occurs before step 2, segment 1 occurs before segment 2)
- Each video segment belongs to exactly one procedure step (no segment can belong to multiple steps)
- Segments assigned to the same procedure step must be consecutive or temporally close
- Procedure steps must be assigned to segments in chronological order (step 1 maps to earlier segments than step 2)
- Every segment must be assigned (no unmapped segments)
- Every procedure step must have at least one assigned segment (no empty procedure steps)
- Maintain temporal coherence throughout the entire mapping

GUIDANCE FOR AMBIGUOUS CASES:
- If a procedure step is not explicitly shown in the video but is implied by the sequence of actions, assign it to the segment(s) where evidence of that step becomes apparent
- Look for implicit evidence: a step may not have explicit narration but can be inferred from the context or timing of surrounding actions
- If a step seems missing, consider if it could have occurred during segments allocated to nearby steps or if it represents a transitional action between visible segments
- Prioritize semantic coherence: choose the most logical segment assignment that maintains the procedural flow

HANDLING CONFLICTS AND EDGE CASES:

**Ensuring Complete Coverage:**
- CRITICAL: Every segment from 1 to {total_blocks} MUST be assigned to exactly one step (no unmapped segments allowed)
- If a segment's purpose is unclear, assign it to the step that most closely precedes it temporally
- Never skip segments - if you've assigned segment N to a step, the next segment N+1 must be assigned to the same step or the next step, never to an earlier step
- If a segment doesn't semantically fit any remaining unassigned step, assign it to the most recent step that already has assignments

**Preventing Temporal Violations:**
- CRITICAL: Segments must be assigned in strict chronological order - once you assign segment N to a step, all future segments must be assigned to that step or later steps
- You CANNOT assign an earlier segment to a later step if you've already assigned later segments to previous steps
- If you've assigned segment 10 to step 5, you cannot later assign segment 7 to step 6
- Forward assignment only: process segments 1â†’2â†’3â†’...â†’N in order and assign each to a step (same step or advancing to the next step)

**Handling Ambiguous Segments:**
- If a segment doesn't clearly belong to any specific step, assign it to the step currently being populated (the step with the most recently assigned segments)
- If a segment could belong to multiple steps, assign it to the EARLIER step, not the later one
- Better to group too many segments with one step than to leave any segment unassigned

**Step Assignment Requirements:**
- Every procedure step MUST have at least one assigned segment (no empty steps)
- If a procedure step has no semantically clear match, assign it the next unassigned segment
- Process steps in order (1, 2, 3, ...) and ensure each gets at least one segment before moving to the next

Below is an example.
Here are the procedure steps (in temporal order):
1. ðŸŸ¢ Assemble the chassis by attaching and screwing the chassis parts together.
2. ðŸ”µ Attach wheels to the chassis.
3. ðŸŸ¡ Assemble the arm and attach it to the chassis.
4. âšª Attach the body to the chassis.
5. ðŸŸ£ Add the cabin window to the chassis.
6. ðŸ”´ Finalize the assembly and demonstrate the toy's functionality.

Here are the video transcript segments (in temporal order):
1. ðŸŸ¢  attach interior to chassis
2. ðŸ”µ  attach wheel to chassis
3. ðŸ”µ  attach arm to turntable top
4. ðŸŸ¡  attach hook to arm
5. ðŸŸ¡  attach turntable top to chassis
6. âšª  attach cabin to interior
7. ðŸŸ£  demonstrate functionality

Output a JSON mapping where the key is the procedure step ID and the value is a list of video segment IDs that represent that step. CONSTRAINTS: (1) Each video segment must be assigned to exactly one procedure step, (2) Every segment must be assigned (no unmapped segments), (3) All segment assignments must respect temporal order.
```

### LLM Response:

```json
{
    "mapping": {
        "1": ["1"],
        "2": ["2"],
        "3": ["3", "4"],
        "4": ["5"],
        "5": ["6"],
        "6": ["7"]
    },
    "reasoning": "Step 1 maps to segment 1 (attaching interior to chassis corresponds to assembling the chassis). Step 2 maps to segment 2 (attaching wheel to chassis is the wheel attachment step). Step 3 maps to segments 3-4 (arm assembly involves arm to turntable attachment and hook to arm attachment). Step 4 maps to segment 5 (attaching turntable top to chassis is the body assembly action). Step 5 maps to segment 6 (attaching cabin to interior is where the cabin window addition occurs - while not explicitly mentioned, this is the most semantically related segment for the cabin window step). Step 6 maps to segment 7 (demonstrate functionality). Each segment is assigned to exactly one procedure step, and all procedure steps have at least one segment."
}
```

### Mapping Interpretation:

- **Procedure Step 1** â†’ **Segment 1**: Interior attachment corresponds to chassis assembly
- **Procedure Step 2** â†’ **Segment 2**: Wheel attachment is directly shown
- **Procedure Step 3** â†’ **Segments 3, 4**: Arm assembly spans two segments (arm to turntable attachment, hook to arm attachment)
- **Procedure Step 4** â†’ **Segment 5**: Turntable top to chassis attachment represents body assembly
- **Procedure Step 5** â†’ **Segment 6**: Cabin to interior attachment is where the cabin window is added (most semantically related segment for this step)
- **Procedure Step 6** â†’ **Segment 7**: Functionality demonstration is clearly shown
- **Complete Coverage**: Every video segment (1-7) is assigned to exactly one procedure step, and every procedure step has at least one assigned segment (no empty steps).

This mapping creates a temporal grounding of the procedure steps to the actual video content, enabling the system to link abstract procedural knowledge with concrete video evidence. Each segment belongs to exactly one step, and all steps have assignments.
